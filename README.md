# 카프카 테스트

#### ___2021-04-23___
- 브로커 2개의 클러스터에서는 토픽 생성시 리플리케이션팩터를 1을 설정해도 프로듀서가 메시지 전송시 문제가 없었으나,
  브로커 3개의 클러스터에서는 토픽 생성시, 에러 ```Messages are rejected since there are fewer in-sync replicas than required``` 가 발생함
  토픽 생성시 리플리케이션팩터를 2또는 3을 설정해줘야 에러가 발생하지 않는다.
  리플리케이션팩터는 해당 토픽의 메시지들을 몇 개의 인스턴스에 저장될지에 대한 수로, 숫자를 많이 줄 수록 해당 토픽에 대한 메시지 저장공간이 배로 늘어난다.
  그러므로, 중요도가 낮은 토픽에 대해선 2를 설정하고 중요도가 높은 토픽에 대해선 3을 설정할 수 있다.
  
- 그룹 아이디가 같은 컨슈머가 둘이 서브스크립션하면, 컨슈머를 실행한 콘솔엔 리밸런싱관련 로그가 뜨면서,
  메시지를 한동안 받지 않게 되고, 리밸런싱이 끝나면 하나의 컨슈머만 메시지를 받는다.
  모든 컨슈머가 메시지를 받을 수 있게 하려면, 그룹 아이디를 모두 다르게 해야 한다.
  다른 방법이 있는지는 아직 확인하지 못했다...

- 아마존에서 카프카를 설정하려면, MSK 서비스에서 클러스터를 생성하면 되고,
  생성시 주의할 점은, 테스트 또는 운영할 EC2 인스턴스 또는 EKS 와 같은 VPC 내에 생성해야 한다.
  테스트할땐, 최대한 기본 설정에 따라 만들고, 저장소 용량과 브로커 타입 정도만 최소 사양으로 맞춰서 테스트했다~
  57시간 테스트 했는데, 3.25 달러밖에 안나왔다 ㅎㅎ
  
